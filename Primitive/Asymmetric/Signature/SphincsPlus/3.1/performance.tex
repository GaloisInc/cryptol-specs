% @author Daniel J. Bernstein
% @author Andreas Hülsing
% @author Stefan Kölbl
% @author Ruben Niederhagen
% @author Joost Rijneveld
% @author Peter Schwabe
% @copyright The authors
\section{Performance}

In order to obtain benchmarks,
we evaluate our reference implementation on a machine using the Intel x86-64 instruction set.
In particular, we use a single core of a 3.1 GHz Intel Xeon E3-1220 CPU (Haswell).
We follow the standard practice of disabling TurboBoost and hyper-threading.
Furthermore, it has 32GiB of RAM and the system ran on Ubuntu 18.04 with Linux kernel is 4.15.0-96-generic.
We compiled the code using gcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0, with the compiler optimization flag \texttt{-O3}.

\subsection{Runtime}

For the defined parameter sets, the resulting cycle counts are listed in Table~\ref{tab:runtime}.

We also provide optimized implementations for platforms supporting the AVX2 instruction set. For \haraka, it is especially relevant to also examine platforms that have the AES-NI instruction set available.
We used the same system as described above, this time including the \texttt{march=native} compiler flag, as well as \texttt{flto} and \texttt{fomit-frame-pointer}.
Performance results are listed in Table~\ref{tab:runtimeaesni}, Table~\ref{tab:runtimesha} and Table~\ref{tab:runtimeshake}.

\begin{table}
    \centering
    \def\arraystretch{1.2}
    \setlength\tabcolsep{0.3cm}
    \begin{tabularx}{\textwidth}{Xrrr}
        \hline
         & key generation & signing & verification \\
        \hline
%% Round 2 parameters
%% \spxshakelowsmall-simple & 326\,804\,702 & 4\,868\,849\,344 & 5\,304\,418 \\
%% \spxshakelowsmall-robust & 653\,644\,974 & 8\,823\,025\,510 & 10\,682\,788 \\
%% \spxshakelowfast-simple & 10\,281\,278 & 325\,310\,988 & 13\,540\,758 \\
%% \spxshakelowfast-robust & 19\,398\,874 & 586\,782\,176 & 25\,912\,718 \\
%% \spxshakemidsmall-simple & 486\,772\,896 & 10\,259\,965\,348 & 7\,971\,308 \\
%% \spxshakemidsmall-robust & 920\,088\,478 & 17\,933\,686\,398 & 15\,934\,714 \\
%% \spxshakemidfast-simple & 15\,636\,286 & 417\,285\,114 & 21\,426\,046 \\
%% \spxshakemidfast-robust & 28\,650\,446 & 768\,137\,780 & 40\,724\,386 \\
%% \spxshakehighsmall-simple & 636\,420\,512 & 7\,570\,079\,194 & 10\,865\,898 \\
%% \spxshakehighsmall-robust & 1\,209\,991\,946 & 13\,798\,734\,692 & 20\,819\,566 \\
%% \spxshakehighfast-simple & 45\,332\,108 & 936\,984\,925 & 22\,081\,404 \\
%% \spxshakehighfast-robust & 76\,811\,460 & 1\,686\,173\,450 & 42\,857\,756 \\
\spxshakelowsmall-simple & 616\,484\,336 & 4\,682\,570\,992 & 4\,764\,084 \\
\spxshakelowsmall-robust & 1\,195\,409\,786 & 8\,995\,481\,640 & 9\,232\,084 \\
\spxshakelowfast-simple & 9\,649\,130 & 239\,793\,806 & 12\,909\,924 \\
\spxshakelowfast-robust & 18\,726\,982 & 460\,757\,304 & 28\,152\,828 \\
\spxshakemidsmall-simple & 898\,362\,434 & 8\,091\,419\,556 & 6\,465\,506 \\
\spxshakemidsmall-robust & 1\,753\,646\,932 & 15\,306\,007\,790 & 13\,509\,022 \\
\spxshakemidfast-simple & 14\,215\,518 & 386\,861\,992 & 19\,876\,926 \\
\spxshakemidfast-robust & 27\,463\,376 & 734\,072\,042 & 39\,295\,686 \\
\spxshakehighsmall-simple & 594\,081\,566 & 7\,085\,272\,100 & 10\,216\,560 \\
\spxshakehighsmall-robust & 1\,156\,363\,648 & 13\,198\,544\,260 & 19\,292\,734 \\
\spxshakehighfast-simple & 36\,950\,136 & 763\,942\,250 & 19\,886\,032 \\
\spxshakehighfast-robust & 72\,503\,094 & 1\,467\,095\,732 & 39\,555\,542 \\
        \hline
%% Round 2 parameters
%% \spxshalowsmall-simple & 184\,989\,822 & 2\,750\,786\,210 & 2\,946\,546 \\
%% \spxshalowsmall-robust & 364\,674\,556 & 5\,052\,490\,210 & 6\,324\,024 \\
%% \spxshalowfast-simple & 5\,832\,302 & 184\,331\,594 & 7\,565\,956 \\
%% \spxshalowfast-robust & 11\,324\,958 & 340\,006\,156 & 14\,989\,588 \\
%% \spxshamidsmall-simple & 270\,111\,082 & 6\,696\,720\,282 & 4\,696\,768 \\
%% \spxshamidsmall-robust & 543\,163\,562 & 12\,479\,060\,094 & 10\,171\,216 \\
%% \spxshamidfast-simple & 8\,440\,088 & 239\,058\,706 & 12\,018\,412 \\
%% \spxshamidfast-robust & 17\,118\,014 & 468\,980\,776 & 25\,420\,488 \\
%% \spxshahighsmall-simple & 362\,079\,622 & 4\,695\,090\,806 & 6\,605\,242 \\
%% \spxshahighsmall-robust & 1\,027\,497\,016 & 12\,620\,787\,424 & 19\,112\,510 \\
%% \spxshahighfast-simple & 22\,660\,544 & 563\,064\,298 & 12\,369\,486 \\
%% \spxshahighfast-robust & 63\,854\,612 & 1\,491\,948\,282 & 37\,592\,580 \\
\spxshalowsmall-simple & 358\,061\,994 & 2\,721\,595\,944 & 2\,712\,044 \\
\spxshalowsmall-robust & 714\,027\,022 & 5\,363\,065\,742 & 5\,561\,194 \\
\spxshalowfast-simple & 5\,590\,602 & 138\,610\,500 & 7\,757\,942 \\
\spxshalowfast-robust & 11\,135\,058 & 273\,836\,364 & 16\,101\,098 \\
\spxshamidsmall-simple & 524\,116\,024 & 5\,012\,149\,284 & 4\,333\,066 \\
\spxshamidsmall-robust & 1\,059\,562\,738 & 9\,893\,267\,932 & 8\,557\,224 \\
\spxshamidfast-simple & 8\,227\,944 & 232\,973\,880 & 11\,768\,382 \\
\spxshamidfast-robust & 16\,581\,076 & 458\,983\,816 & 24\,679\,894 \\
\spxshahighsmall-simple & 346\,844\,762 & 4\,499\,800\,456 & 6\,060\,438 \\
\spxshahighsmall-robust & 1\,006\,905\,074 & 12\,382\,647\,014 & 18\,784\,558 \\
\spxshahighfast-simple & 21\,763\,590 & 468\,188\,036 & 11\,934\,164 \\
\spxshahighfast-robust & 62\,599\,672 & 1\,312\,473\,846 & 37\,139\,082 \\

        \hline
%% \spxharakalowsmall-simple & 611\,292\,194 & 11\,119\,913\,286 & 12\,584\,080 \\
%% \spxharakalowsmall-robust & 931\,428\,938 & 17\,284\,565\,968 & 18\,851\,546 \\
%% \spxharakalowfast-simple & 19\,193\,404 & 696\,339\,010 & 28\,896\,208 \\
%% \spxharakalowfast-robust & 28\,784\,662 & 1\,060\,918\,954 & 45\,725\,396 \\
%% \spxharakamidsmall-simple & 903\,708\,852 & 24\,735\,733\,262 & 19\,016\,088 \\
%% \spxharakamidsmall-robust & 1\,368\,695\,224 & 41\,842\,359\,678 & 29\,913\,446 \\
%% \spxharakamidfast-simple & 28\,434\,600 & 819\,709\,720 & 44\,842\,894 \\
%% \spxharakamidfast-robust & 42\,770\,082 & 1\,275\,577\,642 & 71\,961\,000 \\
%% \spxharakahighsmall-simple & 1\,199\,731\,412 & 17\,937\,297\,058 & 26\,452\,654 \\
%% \spxharakahighsmall-robust & 1\,819\,478\,400 & 28\,357\,042\,512 & 41\,620\,212 \\
%% \spxharakahighfast-simple & 75\,337\,896 & 2\,025\,944\,026 & 48\,097\,888 \\
%% \spxharakahighfast-robust & 113\,956\,508 & 3\,147\,578\,594 & 76\,008\,016 \\
\spxharakalowsmall-simple & 576\,421\,410 & 4\,594\,239\,682 & 5\,211\,916 \\
\spxharakalowsmall-robust & 1\,095\,155\,240 & 8\,555\,157\,606 & 9\,749\,770 \\
\spxharakalowfast-simple & 9\,137\,070 & 232\,172\,172 & 13\,148\,448 \\
\spxharakalowfast-robust & 17\,119\,708 & 430\,223\,622 & 27\,216\,072 \\
\spxharakamidfast-simple & 13\,399\,816 & 392\,561\,468 & 20\,424\,354 \\
\spxharakamidfast-robust & 25\,376\,582 & 736\,487\,034 & 40\,090\,578 \\
\spxharakamidsmall-simple & 857\,570\,254 & 8\,710\,115\,544 & 7\,572\,424 \\
\spxharakamidsmall-robust & 1\,625\,369\,822 & 16\,200\,067\,256 & 15\,276\,532 \\
\spxharakahighfast-simple & 35\,650\,224 & 832\,534\,808 & 22\,061\,746 \\
\spxharakahighfast-robust & 67\,266\,388 & 1\,519\,602\,658 & 42\,244\,366 \\
\spxharakahighsmall-simple & 569\,851\,046 & 8\,717\,853\,894 & 11\,740\,252 \\
\spxharakahighsmall-robust & 1\,077\,657\,774 & 15\,566\,614\,908 & 22\,516\,650 \\
        \hline
    \end{tabularx}
    \caption{Runtime benchmarks for \spx}
    \label{tab:runtime}
\end{table}

\begin{table}
    \centering
    \def\arraystretch{1.2}
    \setlength\tabcolsep{0.3cm}
    \begin{tabularx}{\textwidth}{Xrrr}
        \hline
         & key generation & signing & verification \\
        \hline
%% \spxharakalowsmall-simple & 20\,266\,748 & 388\,160\,502 & 526\,778 \\
%% \spxharakalowsmall-robust & 25\,175\,490 & 525\,325\,702 & 825\,624 \\
%% \spxharakalowfast-simple & 635\,040 & 23\,068\,406 & 1\,247\,554 \\
%% \spxharakalowfast-robust & 791\,448 & 30\,671\,364 & 2\,003\,620 \\
%% \spxharakamidsmall-simple & 30\,310\,220 & 836\,167\,260 & 799\,002 \\
%% \spxharakamidsmall-robust & 40\,014\,574 & 1\,306\,746\,272 & 1\,423\,764 \\
%% \spxharakamidfast-simple & 980\,594 & 28\,183\,190 & 1\,933\,900 \\
%% \spxharakamidfast-robust & 1\,255\,122 & 39\,063\,916 & 3\,394\,142 \\
%% \spxharakahighsmall-simple & 41\,067\,660 & 584\,481\,098 & 1\,107\,182 \\
%% \spxharakahighsmall-robust & 51\,724\,416 & 814\,757\,982 & 1\,771\,960 \\
%% \spxharakahighfast-simple & 2\,510\,476 & 65\,722\,484 & 1\,971\,780 \\
%% \spxharakahighfast-robust & 3\,232\,804 & 90\,337\,344 & 3\,395\,252 \\

\spxharakalowsmall-simple & 30\,075\,604 & 240\,763\,926 & 308\,774 \\
\spxharakalowsmall-robust & 37\,113\,806 & 304\,905\,780 & 432\,066 \\
\spxharakalowfast-simple & 482\,332 & 12\,196\,792 & 799\,808 \\
\spxharakalowfast-robust & 587\,548 & 15\,176\,760 & 1\,072\,774 \\
\spxharakamidsmall-simple & 46\,369\,950 & 481\,682\,614 & 480\,264 \\
\spxharakamidsmall-robust & 63\,387\,838 & 718\,896\,354 & 759\,952 \\
\spxharakamidfast-simple & 732\,770 & 21\,433\,286 & 1\,205\,698 \\
\spxharakamidfast-robust & 998\,446 & 30\,866\,288 & 1\,799\,300 \\
\spxharakahighsmall-simple & 28\,822\,310 & 451\,164\,660 & 696\,980 \\
\spxharakahighsmall-robust & 40\,954\,800 & 677\,039\,436 & 1\,046\,096 \\
\spxharakahighfast-simple & 1\,809\,078 & 41\,973\,226 & 1\,252\,598 \\
\spxharakahighfast-robust & 2\,599\,368 & 61\,706\,762 & 1\,854\,540 \\
        \hline
    \end{tabularx}
    \caption{Runtime benchmarks for \spx-\haraka on AES-NI}
    \label{tab:runtimeaesni}
\end{table}

\begin{table}
    \centering
    \def\arraystretch{1.2}
    \setlength\tabcolsep{0.3cm}
    \begin{tabularx}{\textwidth}{Xrrr}
        \hline
         & key generation & signing & verification \\
        \hline
%% \spxshalowsmall-simple & 51\,002\,634 & 870\,213\,200 & 2\,363\,926 \\
%% \spxshalowsmall-robust & 99\,077\,348 & 1\,694\,250\,518 & 4\,758\,786 \\
%% \spxshalowfast-simple & 1\,542\,050 & 50\,549\,302 & 6\,043\,932 \\
%% \spxshalowfast-robust & 3\,080\,606 & 100\,693\,962 & 12\,011\,274 \\
%% \spxshamidsmall-simple & 67\,444\,844 & 1\,662\,912\,944 & 3\,738\,242 \\
%% \spxshamidsmall-robust & 138\,738\,718 & 3\,138\,744\,014 & 7\,807\,106 \\
%% \spxshamidfast-simple & 2\,170\,564 & 68\,526\,102 & 9\,489\,674 \\
%% \spxshamidfast-robust & 4\,244\,106 & 129\,583\,418 & 19\,479\,362 \\
%% \spxshahighsmall-simple & 84\,889\,708 & 1\,097\,096\,196 & 4\,971\,256 \\
%% \spxshahighsmall-robust & 344\,908\,072 & 4\,005\,893\,418 & 13\,969\,990 \\
%% \spxshahighfast-simple & 5\,325\,492 & 134\,155\,014 & 9\,507\,660 \\
%% \spxshahighfast-robust & 21\,473\,036 & 491\,934\,098 & 28\,078\,848 \\
\spxshalowsmall-simple & 84\,964\,790 & 644\,740\,090 & 861\,478 \\
\spxshalowsmall-robust & 175\,257\,460 & 1\,328\,848\,352 & 1\,827\,104 \\
\spxshalowfast-simple & 1\,334\,220 & 33\,651\,546 & 2\,150\,290 \\
\spxshalowfast-robust & 2\,748\,026 & 68\,541\,846 & 4\,801\,338 \\
\spxshamidsmall-simple & 125\,310\,788 & 1\,246\,378\,060 & 1\,444\,030 \\
\spxshamidsmall-robust & 260\,903\,972 & 2\,517\,396\,082 & 3\,103\,732 \\
\spxshamidfast-simple & 1\,928\,970 & 55\,320\,742 & 3\,492\,210 \\
\spxshamidfast-robust & 4\,063\,066 & 113\,484\,456 & 7\,552\,358 \\
\spxshahighsmall-simple & 80\,943\,202 & 1\,025\,721\,040 & 1\,986\,974 \\
\spxshahighsmall-robust & 339\,101\,780 & 3\,912\,132\,754 & 8\,294\,732 \\
\spxshahighfast-simple & 5\,067\,546 & 109\,104\,452 & 3\,559\,052 \\
\spxshahighfast-robust & 21\,327\,470 & 435\,984\,168 & 14\,938\,510 \\
        \hline
    \end{tabularx}
    \caption{Runtime benchmarks for \spx-\shatwo on AVX2}
    \label{tab:runtimesha}
\end{table}

\begin{table}
    \centering
    \def\arraystretch{1.2}
    \setlength\tabcolsep{0.3cm}
    \begin{tabularx}{\textwidth}{Xrrr}
        \hline
         & key generation & signing & verification \\
        \hline
%% \spxshakelowsmall-simple & 125\,035\,416 & 2\,001\,411\,090 & 3\,653\,506 \\
%% \spxshakelowsmall-robust & 250\,522\,744 & 3\,688\,379\,854 & 7\,308\,492 \\
%% \spxshakelowfast-simple & 3\,902\,878 & 129\,136\,942 & 9\,384\,850 \\
%% \spxshakelowfast-robust & 7\,829\,040 & 244\,051\,334 & 18\,091\,368 \\
%% \spxshakemidsmall-simple & 189\,670\,362 & 4\,290\,526\,660 & 6\,021\,100 \\
%% \spxshakemidsmall-robust & 377\,942\,400 & 7\,580\,954\,948 & 11\,239\,570 \\
%% \spxshakemidfast-simple & 5\,917\,304 & 169\,705\,656 & 14\,805\,532 \\
%% \spxshakemidfast-robust & 11\,657\,462 & 324\,466\,078 & 28\,962\,868 \\
%% \spxshakehighsmall-simple & 253\,675\,454 & 3\,073\,784\,582 & 7\,269\,736 \\
%% \spxshakehighsmall-robust & 478\,658\,620 & 5\,522\,528\,018 & 14\,891\,796 \\
%% \spxshakehighfast-simple & 15\,827\,074 & 371\,718\,550 & 15\,343\,652 \\
%% \spxshakehighfast-robust & 29\,918\,566 & 677\,977\,122 & 29\,685\,120 \\

\spxshakelowsmall-simple & 143\,900\,796 & 1\,102\,470\,520 & 1\,189\,102 \\
\spxshakelowsmall-robust & 274\,483\,474 & 2\,076\,548\,104 & 2\,408\,782 \\
\spxshakelowfast-simple & 2\,249\,444 & 56\,933\,788 & 3\,346\,068 \\
\spxshakelowfast-robust & 4\,272\,402 & 106\,032\,762 & 6\,677\,094 \\
\spxshakemidsmall-simple & 206\,105\,502 & 1\,910\,461\,606 & 1\,653\,314 \\
\spxshakemidsmall-robust & 397\,548\,084 & 3\,549\,895\,260 & 3\,300\,788 \\
\spxshakemidfast-simple & 3\,220\,902 & 89\,875\,552 & 4\,783\,424 \\
\spxshakemidfast-robust & 6\,175\,702 & 167\,173\,520 & 9\,330\,848 \\
\spxshakehighsmall-simple & 136\,190\,230 & 1\,650\,717\,926 & 2\,559\,892 \\
\spxshakehighsmall-robust & 258\,430\,892 & 2\,982\,404\,428 & 4\,669\,406 \\
\spxshakehighfast-simple & 8\,535\,534 & 176\,951\,378 & 5\,030\,988 \\
\spxshakehighfast-robust & 16\,296\,098 & 329\,696\,258 & 9\,716\,888 \\
        \hline
    \end{tabularx}
    \caption{Runtime benchmarks for \spx-\shathree on AVX2}
    \label{tab:runtimeshake}
\end{table}

\subsection{Space}

In Table~\ref{tab:space}, we list the key and signature sizes (in bytes) for the defined parameter sets.
In terms of memory consumption, we remark that the reference implementation tends towards low stack usage.
This shows for example in procedures such as computing authentication paths and tree roots,
which is done using the treehash algorithm
(which requires stack usage linear in the tree height, rather than the naive exponential approach of first computing the entire tree and then cherry-picking the relevant nodes).

\begin{table}
    \centering
    \def\arraystretch{1.2}
    \setlength\tabcolsep{0.3cm}
    \begin{tabularx}{\textwidth}{Xrrr}
        \hline
         & public key size & secret key size & signature size \\
        \hline
        \spxlowsmall & 32 & 64 & 7\,856 \\
        \spxlowfast & 32 & 64 & 17\,088 \\
        \spxmidsmall & 48 & 96 & 16\,224  \\
        \spxmidfast & 48 & 96 & 35\,664 \\
        \spxhighsmall & 64 & 128 & 29\,792 \\
        \spxhighfast & 64 & 128 & 49\,856 \\
        \hline
    \end{tabularx}
    \caption{Key and signature sizes in bytes}
    \label{tab:space}
\end{table}
