/*
 * Test vectors for ECDSA with curve P521 and SHA3-512.
 *
 * The only test vectors we could find for SHA3 were from the ACVP program. The
 * KATs for checking signatures didn't include the nonce `k`, which is necessary
 * to randomize the signature, so this does not include any KATs for signing;
 * only for verification.
 *
 * [ACVP]: NIST. usnistgov. GitHub repo "ACVP-Server".
 *     @see https://github.com/usnistgov/ACVP-Server/blob/master/gen-val/json-files/ECDSA-SigGen-FIPS186-5
 *
 * @copyright Galois, Inc.
 * @author Marcella Hastings <marcella@galois.com>
 */
module Primitive::Asymmetric::Signature::ECDSA::Tests::ECDSA_P521_SHA3_512 where
import Primitive::Asymmetric::Signature::ECDSA::Instantiations::ECDSA_P521_SHA3_512 as ECDSA
import Common::utils(BVtoZ)
import Common::EC::PrimeField::Instantiations::P521 as EC

/**
 * This tests the signature verification vectors for curve "P-521" and hashAlg
 * "SHA3-512" from [ACVP] "ECDSA-SigGen-FIPS186-5".
 * ```repl
 * :prove testVerification
 * ```
 */
property testVerification = publicKeyWorks && sigVerWorks where
    // Check that the provided `d` computes the expected public key.
    publicKeyWorks = EC::affineEq (ECDSA::publicKey d) (EC::Affine qx qy)

    d = BVtoZ 0x001A4AF003FFEB8637890F8599500FF0F2F3989BB8708CA6102438916A3195C27B77AB18C4E9F1F30AB7908FB6AE120F50444D7DEAB4D42C330FD9F4F2F53DC819C6
    qx = BVtoZ 0x00F2E9C03432664F654684445A9EE0AA3D227D5D5DCC716FB8CC20EDDD9398ACDD120698D3ED5B684CBE25E9373766BCCDE95D2CF96619DB755D31FD72C89B4BFEF7
    qy = BVtoZ 0x001C467979C0B8CB63DD2CD9D9DE89E04AA4021F6BDAB8A23789B12EC95640926D3955FC58A12F9A32A6917B59068953EB652D1948112319A19FAC90E505779771A7

    // Check that the given message-signature pairs all verify.
    checkSigVer msg r s = ECDSA::verify msg (r, s) (ECDSA::publicKey d)
    sigVerWorks = and [checkSigVer msg (BVtoZ r) (BVtoZ s) | (msg, r, s) <- [
        (msg451, r451, s451),
        (msg452, r452, s452),
        (msg453, r453, s453),
        (msg454, r454, s454),
        (msg455, r455, s455),
        (msg456, r456, s456),
        (msg457, r457, s457),
        (msg458, r458, s458),
        (msg459, r459, s459),
        (msg460, r460, s460)
    ]]

    // See "internalProjection.json", section "tgId = 46".
    msg451 = 0x677E4023984349869CEAB290883D4F1CCE1AFE9B2CB23F5A04508F06BBEB75D39DCEA7804D1F8E434A9032C6CE99CD7521B740661628130EFF8E4327879317CEB0812A56B370D40F8014C33FC13EE947771699D2BA2554C7255BF1212E0F580DD0F305B7E1448CBB8AFA8C6BF0386AF0AF7137DFA1E7C1B5380C9B402B5E090D
    r451 = 0x0191D1682FE97586B0F88122036202609D03E26B6998E18D4287245B44A10EAF6B8FC06187BAFDF811ADF2F61CA1F30090CAF95EDE3B9AEBA0C53CB3D9968E22B19F
    s451 = 0x012486B9A6865FFA6688E988F48B98CFAA477AB72E0CD49230E269BA44BAB091F82AAA71DF80A709DDDA4736202F19CF9515BBDE59B516511D4B981525071D801A01

    msg452 = 0xC0D8122F35218B0DE0D3358747A0C7F39C0FD2B43114783E976DF536E68AF95A5C82F0BBCD8A8D2D7422327450C911CF01B385D866F884B194E0BAC34E003013488651586FC8A622E738ACB5C50C1E51304436169E41E1ADDB608473AC756621D8F8816F1B411337CA241947A6601118546638B521080BC9F56C9A8300704601
    r452 = 0x009ED308D3026590AFBD7B20EC98F4450A4C937EB69343801E7340917DACEC0242DE57A781217A6212222F1D9E6A4B244E27846D0AF9535F883565AA387F1B22B156
    s452 = 0x0049AA885305BFBCD933FFAD43EA4511F2DD01F9FD341701E2F8552096FD220217B123CE6D5315C9AFB62A738AD1782340C8BDDC15CDF26EB9111B3F629FF21C2EF0

    msg453 = 0x6EE2EDDB33541723004E685F670D23053114FFAFB7EAE55607AFF93D7C398A71663A67443C2C439C422833A0865F90ABA3F882D790F430D526290876F1594B34EEEFBEF7B9C7FDB3EC8FA3E8C00B801026EA96C86D79612431200B3AE02F2BE610F3AC066FB6963AC0EF51F11962F63164E8A51C3F5B279BF52DAE4F01BEA33D
    r453 = 0x009AC0B7B0ABC15A986F796792378EC8344E0C7987B369F4E496BAA6F58A75F73F6F5E057F5AB8225A53C5E89315AFAF3656E318AECB8BC7BA6E28820995359D5C6F
    s453 = 0x00459EF567351F758BC511BF76B67C88705A131B7F73A5220D9055820B230800D477795DFB9B9D34613B3E81BE847FE45455048A9FF92CB65DDE4DB3C1815B2EB7B5

    msg454 = 0x08BFB009D144C8687440EFA54396BA0675B6F8351A5C59CB4C7FEA160919672C1D205ECD3F7128906455EFF4E3FC91B0A95F871CC5C3D0668CF07BFAD42CBE6435D2A2D5466366FDD3BDF8EAC3E6BBC779BE43C77D9CFEBFF5A430A56FFB4D5D40B3DB9FC40B6FEC2705B8C483C60BBD95EAF62289FF17107266E0B5508D038B
    r454 = 0x013271D0A9B8DB61CE731B187763ABB7D1CD62C38E080435B4CE457A171096D1B13D6E1477644C6D9E4CBBEB573B50BB8FAA464035C7CD65AFDBECEE2C93AED547C0
    s454 = 0x01E58DA0182BA0BF06D9E012BBD1377DE8BFF6E92FD6A1C95C7699114DB67FBAB230A801724DDF20B68C61FBDC439A141928DA29BB61D0839FA488F35CE71C856DE4

    msg455 = 0x5E7032E3F5808EC3387D29124D2A2E6219DCE868C671F1DC7EE928564E4778AB7D67D08E3A3CF6A260416102730B44781408715D67F24D2FFF6C1FEB22EE049A809D1D92A2426A8B394F5B14A0F1489DD54B4552E2F8489BF973D1A4C72FF2BB5501F3BCA91AC4595B5355B08D47A2D110E61A14AA599C745AC7AC679CC5DE8E
    r455 = 0x0169794422CBD853A85C152849B7DF0AB9E11B4E72C8CCE6DA4D78ED35A5C7189256F922E1764BE6FC3D3942CD7E6B30AF18358B50DF72DDD0423037A2347EDD6D6E
    s455 = 0x0118C65DE4ECD1BC7730DABED1F43B2B95FB9C866B15AD482FA0A8BE6EB145C04A819D0B8EC682415A708D2FBCD8C8915BFDE632CF15C8E452C1FA5B707390CCA9F4

    msg456 = 0x461F9444A9FAD785426CEB5C46DEC5251CD408D9A0A6F1BA9C286E5AB45E11784F71939E7898B4BDB43F86591C80C30B122B17B37BDCB3DABD0CDC5EB78CC4C8C507DD0AEAD750338784B65380AFC6798626E67926D7802C7B7D75C9CC3C416A920609E3FA4931F8A43E8AFC082E5733D5A89AF9F657CFCFEBD7541BD0F57112
    r456 = 0x0170FFE34F9938D677829F1063B703C6C0E57CCA90312778504A8DBD60FE3E1F51E00FC00C90A7C1BD483A20A259856E0E270C795B6F397E8909B3B08379BF6113A9
    s456 = 0x006BFE4F2E49A672070F94C3208219A1B77DC7FE0C55C738C3BEC5D86D2B35D77BE419BBC27E2FC3BFA60590E2F4D3BAC0AC81DE00D35D45D7CC81B358CFB0825529

    msg457 = 0xEB6C8534FA33F0CE721BD04337FCBAA4F96FF5C23BBD1B557AC0780564778F71B6803382DE2B57D04AA9E7CE8EA7FB199C96F5125E01851EEF635F51033A7759EA5EEA3315573AEE8253C4C0DB0BB8DA127C40DCD179CFA0B348DA191ADA230E69C3DA47810D95DC72C78C2EA23866C97C7A2C2749E11CC4A56C40AA34ADB50F
    r457 = 0x01E838B903C062A51C02390A0B05C506FBA4440BDB8DC483A9CBB2B3B7DF9964B99E61BF5E0FB8939314FF806D18D5A7DA17CFDF5B8942B5495BDE09ADB20DC010A8
    s457 = 0x003A9AF8218071ED3101DF47A06936B2D6ABDF536D8AEE772B9545AD8F4259717405A9BC6D0DA203ABA0A48AD2B97C9CF029C22F1148D5AC29D92757D66EFCE06F40

    msg458 = 0x63FE449ED119BE34F7FBADF9DBA2AB3C20B9F901A93B996690AE522C11243F0291C47307995217B0BA438962A2A2B726A90E3E8B1A2DE7D606DEF0E9CA7977805E4F9B92C8544A5F44142F91129F4480971CA589A49D522D573B5CE4B15CC5E9D49B02E7234F434E97E3296D5A3E1262C2A1458F624C1B6036BEE20BA3E1426D
    r458 = 0x012A4B910E78DEF24786F42C17A46095A795E529A6EB8D252909886B4A36FA1576FEFA05FD085B098ABC3BBDA1B362E46795CFCEA2BE192D96A118C302AAA87A0CBC
    s458 = 0x0183CC181CC879C9CDF7ECFEBABF8CDCB80F1FB3AC18B2D2CD0B7628974026C3047D99731CA10962948D044C96DF2EDB1E38ACAF4FACDDD27336179EF81687738BB3

    msg459 = 0x629E622D7AA532B61EDA6439957A5B547A48B2DC3C062D81C3B9B6B43877ED165B4FB994551125F6B0AACA4C7B2CE504440EEA1E6B87811B33B73E9F9CE260E926DF657A7FA06265661E64BE22603802595297996014F6C1C93935B8768B151468ECACB42E3E57DBA74B3262484B55686FB52BB1F6C9D5D39393B9D67B0AB099
    r459 = 0x0047E0701BE039B95EDB4800422A0383518BB9131165574DA317F09694654A2E0D75B0A9F255B36CA385765A9D7494C90F43232464B64882E106ED682093D54D8542
    s459 = 0x010FE88CFC1CE368FE0E059F8A525530571D33D249B1E78FCCC5FC011A50D7A66DBEC306FFC5F9BEA349F4560EFD8B19006ABA2D91FB0A11790A8928547DB1A03DCB

    msg460 = 0x2515191C99F9AF5D273EAE94C1E4DA326290DF205580E39F4F8B39B69E8DDADA9DB3ADFC63B5394334E5ADD2FA497A84D2411C8ACE2A43D3127CD2D23DE442D510A9DD3C68AD747F1AAE4A9953F51C215E769AE162EB847AEF15AAD73453F17F7E01C7176AD9FA6D227E7552A532E9BC5406262F63C1D7D8C04815631B96FD8F
    r460 = 0x00027948B60ED605E10BEDEF3B87965BB282DD007B92EE836D2E1AF94EA982C88C93BE95C95EEBCD839EB4AA0445547832D184D477C5C1E385BFE0B2E2EBEA5A9648
    s460 = 0x012BA774FD9784EDB0EB7E8B78B97A516AFE4EAF3B78B4AF3A838B719627286539D84CDDE963CC3590CD5F1AB6FC2636E04597208FCB6D670B962DCAB13AAA1F9690
