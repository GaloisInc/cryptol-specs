/*
 * Test vectors for ECDSA with curve P-256 and SHA3-256.
 *
 * The only test vectors we could find for SHA3 were from the ACVP program. The
 * KATs for checking signatures didn't include the nonce `k`, which is necessary
 * to randomize the signature, so this does not include any KATs for signing;
 * only for verification.
 *
 * [ACVP]: NIST. usnistgov. GitHub repo ACVP-Server".
 *     @see https://github.com/usnistgov/ACVP-Server/blob/master/gen-val/json-files/ECDSA-SigGen-FIPS186-5
 *
 * @copyright Galois, Inc.
 * @author Marcella Hastings <marcella@galois.com>
 */
module Primitive::Asymmetric::Signature::ECDSA::Tests::ECDSA_P256_SHA3_256 where
import Primitive::Asymmetric::Signature::ECDSA::Instantiations::ECDSA_P256_SHA3_256 as ECDSA
import Common::utils(BVtoZ)
import Common::EC::PrimeField::Instantiations::P256 as EC

/**
 * This tests the signature verification vectors for curve P-256" and hashAlg
 * SHA3-256" from [ACVP] "ECDSA-SigGen-FIPS186-5".
 * ```repl
 * :prove testVerification
 * ```
 */
property testVerification = publicKeyWorks && sigVerWorks where
    // Check that the provided `d` computes the expected public key.
    publicKeyWorks = EC::affineEq (ECDSA::publicKey d) (EC::Affine qx qy)

    d = BVtoZ 0x250BCED6A85BE3DFCC040EEA5091BFFE76062BCFB0A6A079C95374442BF86D51
    qx = BVtoZ 0xA80DCAC8FAB8F701F7F5F3057552449B326481C6232A89074E1EAC239F5B1B31
    qy = BVtoZ 0x323550775CC6BAB8B89D158E62602971FA62E509B05F92ACF3F56EE1B65DA82B

    // Check that the given message-signature pairs all verify.
    checkSigVer msg r s = ECDSA::verify msg (r, s) (ECDSA::publicKey d)
    sigVerWorks = and [checkSigVer msg (BVtoZ r) (BVtoZ s) | (msg, r, s) <- [
        (msg191, r191, s191),
        (msg192, r192, s192),
        (msg193, r193, s193),
        (msg194, r194, s194),
        (msg195, r195, s195),
        (msg196, r196, s196),
        (msg197, r197, s197),
        (msg198, r198, s198),
        (msg199, r199, s199),
        (msg200, r200, s200)
    ]]

    // See "internalProjection.json", section "tgId = 20".
    msg191 = 0x3D5E46695A845490D2C5B7A6C5BCFC1BC85C6A69EE685ED2080F95B97B2C695BE77698F40FC5BBF51A00BB8B12EFB83A5FD0CDB477DE30D553552F15796E918D51CA957EF75CEB9610E2471E3EB22837240F280CBABA257DF58F51FB5BCBD7621EFA3D3A26DD4A87DC876F9D5C2564A5508BE151D0AF878F04BC5B41E3C81E80
    r191 = 0xCA8F5DF4C1CE7CDE938978D3829F0EB13650E2411E31548A2327716AA47AC5CB
    s191 = 0x4056F1D6F7EBFDA7273B56DF56D14ECC35F27817387FC57190B1338017AC8215

    msg192 = 0x9F28B67E871FB3C6ABA474A6FABA13ED216037BC784113A74A3433E5CE47E047935C45809505FD0BB695C81E045B9DDFFDF1CB5044E3E7E5A94C83842B695B73C27802979A11DEECB17BA05F27BCF3CEB95E4E29BBA3BF96F4E09274F1AE8756F4F0DAF82A563E4C1B86F3047ADBC63BC17533B2BF50639C702CEED95EFA73A4
    r192 = 0x39DE08D2F2A9C35AAC930A0AA3AAB67283326BB39C43019A3CD443992FDD9E12
    s192 = 0xE760CE245D36E718282D8F39E3314F2DCB3BB3FD35C608003D119ABCB20FDBC1

    msg193 = 0x6F6039A60F0CEE666A62E4B96B7F4CDEAD1604A92B4582598138ECCF8B3BB361B745AC32516F71FCC80BFE61EED730D51698B995A3D5F81B928B168009B67168C3D3919B54627666ACA87E246114E497B9F686FDA4763448E10194C8D61EA4462F5F76D36FEACB9D965E0CD81DD91D2753EC9FAEFDA1C839A7008520FF0CC5B9
    r193 = 0x0F4EB4017083CDA99122F9B2CF385EFCB3F5C61308C3D25B0CE6E491222A70B7
    s193 = 0x06E51AC8DB34E395B462687DA40172B78DC5159A37DA1619E4F2379893E8E2E2

    msg194 = 0xA4F1DCFBDB69944C180F9ECC1810C3DC12E2782C69D76742EE108795B108E4C718E4679E708D07311C7928BD818E58C1D9E03E02D0C74B0B904D88E29BB1C540CC205B70D19CBD50E548F4B5E3F78F77F323477749B1E77355393A2DDEED7A112E0BB411064BE4205887B3B73BA145CB7A66D016C2F44B813161BCB6BD15D899
    r194 = 0x12DF2351BAAA94AC2E95204D9D045F65956847AC0A3B8E8AE8E5F7F6F7574C0A
    s194 = 0xB6B7ADFE8E840D9312747793D51D4CA3F6DB4454673ED1E3D4CA940F9A11E63E

    msg195 = 0x4FEAD202C1E557F7E02696A6CA235FFDB0AAFDC67D7FFE865F4774B056B36BD24C9EAAB247B70D242A26D3FE85EB352C291FB3788A0DFFFA9C1AB9CF0A821EB3251B92FF50881C632287D37C799BA018177E32746790EDDE9EFA3A641B30ACFDA34D9A26044CAB5B931B0978EB9DF5D77ED4FFB77FC100BF41974CFBE3B07E2C
    r195 = 0xAFEDB8F2F75D4D5A926F655777D593F3322BC9C84B4B5184D67A6FE07E8DE494
    s195 = 0xF280AF980CC3CC9EEC40AFFD7FE6CE39AEEF357828337FC6D4D8FD38303D10DD

    msg196 = 0x1416E58A2C401C3B69CB6A28F95D10E39BD377C17600E2196823DC99B13593B0534C35B9689FAE8379775CFFF6E6C879A72F85F2BB3D7649D04E29DBC396B2C6CB610EC2D6B71321C532FFED4AB26792FE9F2F63FB5E11620F0C707BC073B67864A6B25E78C619D6938151CD9F855541C9EA4E790E176D7DBF8789F08EA6A216
    r196 = 0x41A85A67ACD8A2C10D2F8F634D16DFD087BC2B5B4D142821A147C865B97B09FB
    s196 = 0xCE54A0E977017B2120D0733DB699F26D8A4E0D403195525A42A023C93730EF35

    msg197 = 0x45E94A50B2B62280FAF914F0B1377E16F9C866E54D2EC3B62DC1233ED5B6A4755E111D7FF0F25D31EA1F5F9E9045ED67B933445DBF4CB662693A4210E70D9F5A98A5369F9F37493E26253103912CF170D10A4C75113D1A95B0BDB7393084571C22F1CB82B6BF7206A8559ADAE26720207473943E2AC24C6327EC5F123EF293C1
    r197 = 0xB0E8402CCEDA89FC6C21922283AE2B369F8155FB728D4963DCC0A0D741ACC4A2
    s197 = 0x4188D4078AAEAC18E2752F6D3E0A1D6E28DA1E7EE7D4487E3A552277669E9614

    msg198 = 0x118536741B470895130060900322DC52DE61FE6CD9C64440946A56A8DD4760858D0C34FF60C137A17BC5DC51CD3980D8F89306C32727AE4584963652E8845AEF512DCA84FBD5E6E5252693870CC9D7CABC3F2C3837B2B257912FD446A75CC70E4CE81AA4043D1725CB3D75DA7F3F7559DCDDAFB093A7D86CD2CEC212FAB1239B
    r198 = 0x0A0A88A81D011D1D2EFCFB8D41F7092060C723F2BB69F344A79FB899A8418071
    s198 = 0xA6519B49CA81B0E87E8DF306B18BB73865D7E9866EE7FDEC7FCDA5E353E3777D

    msg199 = 0xD3DFE0E23CB06DC5E738113B5EB2A3CA1482E76616205A08142715DBF599B9B08158C0A8B4A5527687D59CF84820CC2FB00D508987D960948894878F27F59A84315A5C2BE253D7640C6E3F77B5E29D9CB73CD0901DEB0ADD84A2FC8B0A5EE5C74C52DBE6BD836C809D6E7592B7E537852092ED0CBCE6D60C4019AF4ED475D381
    r199 = 0x14A2EDF740CACF88EF3C8B369455511AC36531D5005AE526312D25ED20C1C285
    s199 = 0x410BC944CA01578E1745F4C8C9E67D3FD8295CDD443805456EE809DE79A22C2B

    msg200 = 0x6843812E88526E3D1B6C9262E4A8C9B672BFDCE3B49542A218200345F6D9E0A4F505C4B3EBBDA7979A0F6F471BD25D7E82EB9A59E8AE682CF76DEC2FE9084C8BB3AE3441274BA10D19C4921CC23910054FEC4D426494522A47EBFF8DCBC05C2C2B32812CD7AC6BD02DFFEE3BD9AF17F6FBB7EF453578BD35DA0BEE921CCF0C07
    r200 = 0x50027E9A9AEC3151E29914F5B41F551F1E538E6429CF5AAFF83141B83336AD94
    s200 = 0x4FFA7C1739586A979EBBBD212A93C1990FA5AC6C29F8512A9FC1A5BC8EA95D4E
